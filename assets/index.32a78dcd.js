import{_ as t,e,f as a}from"./index.9874402d.js";import{I as n,d as l,a2 as o,a3 as s,a4 as i,u as d,k as u,n as c,e as r,b as p,a5 as v,U as m,T as b,p as f,f as h,r as x,o as V,h as k,l as w,j as _,w as j,t as I,F as U}from"./vendor.f24ab909.js";var g=l({name:"AddPage",components:{[o.name]:o,[s.name]:s,[i.name]:i,NavHeader:t},setup(){const t=d(),l=u(),o=c(""),s=r((()=>{var t;return(null==(t=p().params)?void 0:t.id)||""})),i=s.value?"更新":"发布",f=v({tab:"dev",options:[{text:"测试",value:"dev"},{text:"分享",value:"share"},{text:"问答",value:"ask"},{text:"招聘",value:"job"}],title:"",content:""});m((()=>{s.value?(o.value="编辑主题",a(s.value,!1,t.state.user.userInfo.token).then((t=>{f.title=t.title,f.content=t.content,f.tab=t.tab}))):o.value="添加主题"}));return{topic:f,submit:async()=>{if(!f.title)return void b("标题不能为空");if(!f.content)return void b("内容不能为空");const a={accesstoken:t.state.user.userInfo.token,title:f.title,tab:f.tab,content:f.content};try{if(s){a.topic_id=s.value;(await function(t){return n.post("/topics/update",t)}(a)).success&&(b("更新成功"),t.dispatch(`topic/${e}`,{id:s.value}),l.back())}else{(await function(t){return n.post("/topics",t)}(a)).success&&(b("发布成功"),l.replace(`/list?tab=${f.tab}`))}}catch(o){b(s.value?"更新失败":"发布失败")}},title:o,btnText:i}}});f("data-v-2bf44370");const y={class:"d-flex align-items-center van-hairline--bottom add-hd"},T=_("span",null,"选择分类：",-1),M={class:"flex-1"},$={class:"add-title van-hairline--bottom"},A={class:"add-content"};h(),g.render=function(t,e,a,n,l,o){const s=x("nav-header"),i=x("van-dropdown-item"),d=x("van-dropdown-menu"),u=x("van-field");return V(),k(U,null,[w(s,{title:t.title,"show-add":!1},null,8,["title"]),_("div",y,[T,_("div",M,[w(d,null,{default:j((()=>[w(i,{modelValue:t.topic.tab,"onUpdate:modelValue":e[0]||(e[0]=e=>t.topic.tab=e),options:t.topic.options},null,8,["modelValue","options"])])),_:1})]),_("div",{class:"submit-btn",onClick:e[1]||(e[1]=(...e)=>t.submit&&t.submit(...e))},I(t.btnText),1)]),_("div",$,[w(u,{modelValue:t.topic.title,"onUpdate:modelValue":e[2]||(e[2]=e=>t.topic.title=e),modelModifiers:{trim:!0},clearable:"",maxlength:"100",placeholder:"标题，字数10字以上"},null,8,["modelValue"])]),_("div",A,[w(u,{modelValue:t.topic.content,"onUpdate:modelValue":e[3]||(e[3]=e=>t.topic.content=e),rows:"20",type:"textarea",placeholder:"回复支持Markdown语法,请注意标记代码"},null,8,["modelValue"])])],64)},g.__scopeId="data-v-2bf44370";export{g as default};
